!function(a){a.cuar||(a.cuar={}),a.cuar.fileAttachmentManager=function(b,c){var d=this;d.$el=a(b),d.el=b,d.$el.data("cuar.fileAttachmentManager",d),d.init=function(){d.options=a.extend({},a.cuar.fileAttachmentManager.defaultOptions,c),d._getSelectors().first().show(),d._getSelectorInput().change(d._onSelectorInputChanged),d._getAttachmentList().on("click",".cuar-remove-action",d._onRemoveActionClick),a(document).on("cuar:attachmentManager:addItem",d._onAddAttachmentItem),a(document).on("cuar:attachmentManager:sendFile",d._onSendFile),a(document).on("cuar:attachmentManager:updateItem",d._onUpdateAttachmentItem),a(document).on("cuar:attachmentManager:updateItemProgress",d._onUpdateAttachmentItemProgress),a(document).on("cuar:attachmentManager:updateItemState",d._onUpdateAttachmentItemState)},d._onUpdateAttachmentItem=function(a,b,c,e,f){var g=d._getAttachmentItemByFilename(b);return 0==g.length?void console.log("_onUpdateAttachmentItem :: Item "+b+" not found"):void d._updateAttachmentItem(g,c,e,f)},d._onUpdateAttachmentItemProgress=function(a,b,c){var e=d._getAttachmentItemByFilename(b);return 0==e.length?void console.log("_onUpdateAttachmentItemProgress :: Item "+b+" not found"):void d._updateAttachmentItemProgress(e,c)},d._onUpdateAttachmentItemState=function(a,b,c){var e=d._getAttachmentItemByFilename(b);return 0==e.length?void console.log("_onUpdateAttachmentItemState :: Item "+b+" not found"):void d._updateAttachmentItemState(e,c)},d._onSelectorInputChanged=function(){var b=d._getSelectors(),c=a(this).val(),e=b.filter(function(){return a(this).data("method")==c});if(!e.is(":visible")){var f=b.filter(":visible");f.length<=0?e.fadeToggle():f.fadeToggle("fast",function(){e.fadeToggle()})}},d._onRemoveActionClick=function(b){if(b.preventDefault(),confirm(cuar.confirmDeleteAttachedFile)){var c=a(this).closest(d.options.attachmentItem),e=c.data("post-id"),f=c.data("filename");d._updateAttachmentItemState(c,"pending"),a.post(cuar.ajaxUrl,{action:"cuar_remove_attached_file",post_id:e,filename:f},function(a){0==a.success?(a.data.length>0&&alert(a.data[0]),d._updateAttachmentItemState(c,"error")):c.slideUp(400,function(){c.remove()})})}},d._onSendFile=function(b,c,e,f,g,h){var i=d._getAttachmentItemByFilename(f);0==i.length&&(i=d._getAttachmentTemplate().clone(),i.appendTo(d.options.attachmentList)),(void 0===g||0==g.trim().length)&&(g=f),d._updateAttachmentItem(i,e,f,g),d._updateAttachmentItemState(i,"pending"),a.post(cuar.ajaxUrl,{action:"cuar_attach_file",method:c,post_id:e,filename:f,caption:g,extra:h},function(b){if(0==b.success)b.data.length>0&&alert(b.data[0]),d._updateAttachmentItemState(i,"error");else{var c=b.data.file,g=b.data.caption;d._updateAttachmentItem(i,e,c,g),d._updateAttachmentItemState(i,"success"),a(document).trigger("cuar:attachmentManager:fileAttached",[e,f,c,g])}})},d._onAddAttachmentItem=function(a,b,c,e){var f=d._getAttachmentItemByFilename(c);0==f.length&&(f=d._getAttachmentTemplate().clone(),f.appendTo(d.options.attachmentList)),d._updateAttachmentItem(f,b,c,e)},d._updateAttachmentItem=function(a,b,c,d){(void 0===d||0==d.trim().length)&&(d=c),a.data("post-id",b),a.data("filename",c),a.children(".cuar-caption").html(d)},d._updateAttachmentItemState=function(a,b){a.removeClass(function(a,b){return(b.match(/(^|\s)cuar-state-\S+/g)||[]).join(" ")}),a.addClass("cuar-state-"+b);var c=a.children(".cuar-actions"),e=a.children(".cuar-progress");switch(b){case"pending":c.hide(),e.show(),d._updateAttachmentItemProgress(a,0);break;case"error":c.show(),e.hide();break;case"success":c.show(),e.hide()}},d._updateAttachmentItemProgress=function(a,b){var c=a.children(".cuar-progress"),d=c.children(".indeterminate"),e=c.children(".determinate");0>=b?(d.show(),e.hide()):(d.hide(),e.show(),e.css({width:b+"%"}))},d._getAttachmentList=function(){return a(d.options.attachmentList,d.el)},d._getAttachmentItems=function(){return a(d.options.attachmentList+">"+d.options.attachmentItem,d.el)},d._getAttachmentItemByFilename=function(b){return d._getAttachmentItems().filter(function(){return a(this).data("filename")==b})},d._getAttachmentTemplate=function(){return a(d.options.attachmentItemTemplate,d.el).children(d.options.attachmentItem).first()},d._getSelectorInput=function(){return a(d.options.selectorInput,d.el)},d._getSelectors=function(){return a(d.options.selectorList+">"+d.options.selectorItem,d.el)},d.init()},a.cuar.fileAttachmentManager.defaultOptions={attachmentList:".cuar-file-attachments",attachmentItem:".cuar-file-attachment",attachmentItemTemplate:".cuar-file-attachment-template",selectorList:".cuar-file-selectors",selectorItem:".cuar-file-selector",selectorInput:".cuar-file-selector-input"},a.fn.fileAttachmentManager=function(b){return this.each(function(){new a.cuar.fileAttachmentManager(this,b)})}}(jQuery);
//# sourceMappingURL=customer-area.js.map