!function($){$.cuar||($.cuar={}),$.cuar.classicUploader=function(el,options){var base=this;base.$el=$(el),base.el=el,base.$el.data("cuar.classicUploader",base),base.init=function(){base.options=$.extend({},$.cuar.classicUploader.defaultOptions,options),base._getFileInput().css({opacity:0});var postId=base._getPostId(),nonceName="cuar_classic-upload_"+postId,formData={action:"cuar_attach_file",method:"classic-upload",post_id:postId};formData[nonceName]=base._getNonce();var dropzone=base._getDropZone();dropzone.fileupload({url:cuar.ajaxUrl,dataType:"json",paramName:"cuar_file",formData:formData,dropZone:dropzone,add:base._onFileUploadAdd,done:base._onFileUploadDone,fail:base._onFileUploadFail,progress:base._onFileUploadProgress}),$(document).bind("dragover",base._onDragOverDropZone)},base._onDragOverDropZone=function(e){var dropZone=base._getDropZone(),timeout=window.dropZoneTimeout;timeout?clearTimeout(timeout):dropZone.addClass("in");var found=!1,node=e.target;do{if(node===dropZone[0]){found=!0;break}node=node.parentNode}while(null!=node);found?dropZone.addClass("hover"):dropZone.removeClass("hover"),window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,dropZone.removeClass("in hover")},100)},base._onFileUploadAdd=function(e,data){for(var i=0,len=data.files.length;len>i;i++){var filename=data.files[i].name;if(data.files[i].attachmentItem=$(document).triggerHandler("cuar:attachmentManager:addItem",[base._getPostId(),filename,filename]),null==data.files[i].attachmentItem)return!1;$(document).trigger("cuar:attachmentManager:updateItemState",[data.files[i].attachmentItem,"pending"])}data.submit()},base._onFileUploadDone=function(e,data){for(var i=0,len=data.files.length;len>i;i++)if(data.result.success){var newFilename=data.result.data.file,newCaption=data.result.data.caption;$(document).trigger("cuar:attachmentManager:updateItem",[data.files[i].attachmentItem,base._getPostId(),newFilename,newCaption]),$(document).trigger("cuar:attachmentManager:updateItemState",[data.files[i].attachmentItem,"success"])}else{var errorMessage=null;data.result.data.length>0&&(errorMessage=data.result.data[0]),$(document).trigger("cuar:attachmentManager:showError",[data.files[i].attachmentItem,data.files[i].name,errorMessage,!0])}},base._onFileUploadFail=function(e,data){for(var i=0,len=data.files.length;len>i;i++)$(document).trigger("cuar:attachmentManager:showError",[data.files[i].attachmentItem,data.files[i].name,data.errorThrown,!0])},base._onFileUploadProgress=function(e,data){for(var i=0,len=data.files.length;len>i;i++){var progress=parseInt(data.loaded/data.total*100,10);$(document).trigger("cuar:attachmentManager:updateItemProgress",[data.files[i].attachmentItem,progress])}},base._getNonce=function(){return $("#cuar_classic-upload_"+base._getPostId(),base.el).val()},base._getPostId=function(){return base.$el.data("post-id")},base._getDropZone=function(){return $(base.options.dropzone,base.el).first()},base._getFileInput=function(){return $(base.options.fileInput,base.el).first()},base.init()},$.cuar.classicUploader.defaultOptions={dropzone:".cuar-dropzone",fileInput:".cuar-file-input"},$.fn.classicUploader=function(options){return this.each(function(){new $.cuar.classicUploader(this,options)})}}(jQuery),function($){$.cuar||($.cuar={}),$.cuar.fileAttachmentManager=function(el,options){var base=this;base.$el=$(el),base.el=el,base.$el.data("cuar.fileAttachmentManager",base),base.init=function(){base.options=$.extend({},$.cuar.fileAttachmentManager.defaultOptions,options),base._getSelectors().first().show(),base._getSelectorInput().change(base._onSelectorInputChanged),base._getAttachmentList().on("click",".cuar-remove-action",base._onRemoveActionClick),base._getErrorList().on("click",".cuar-dismiss",base._onDismissError),$(document).on("cuar:attachmentManager:addItem",base._onAddAttachmentItem),$(document).on("cuar:attachmentManager:sendFile",base._onSendFile),$(document).on("cuar:attachmentManager:updateFile",base._onUpdateFile),$(document).on("cuar:attachmentManager:updateItem",base._onUpdateAttachmentItem),$(document).on("cuar:attachmentManager:updateItemProgress",base._onUpdateAttachmentItemProgress),$(document).on("cuar:attachmentManager:updateItemState",base._onUpdateAttachmentItemState),$(document).on("cuar:attachmentManager:showError",base._onShowError)},base._onShowError=function(event,item,filename,errorMessage){base._showError(item,filename,errorMessage)},base._onUpdateAttachmentItem=function(event,item,postId,newFilename,newCaption){return 0==item.length?void console.log("_onUpdateAttachmentItem :: Item for not found"):void base._updateAttachmentItem(item,postId,newFilename,newCaption)},base._onUpdateAttachmentItemProgress=function(event,item,progress){return 0==item.length?void console.log("_onUpdateAttachmentItemProgress :: Item not found"):void base._updateAttachmentItemProgress(item,progress)},base._onUpdateAttachmentItemState=function(event,item,state){return 0==item.length?void console.log("_onUpdateAttachmentItemState :: Item not found"):void base._updateAttachmentItemState(item,state)},base._onSelectorInputChanged=function(){var selectors=base._getSelectors(),selection=$(this).val(),target=selectors.filter(function(){return $(this).data("method")==selection});if(!target.is(":visible")){var visibleSelectors=selectors.filter(":visible");visibleSelectors.length<=0?target.fadeToggle():visibleSelectors.fadeToggle("fast",function(){target.fadeToggle()})}},base._onRemoveActionClick=function(event){if(event.preventDefault(),confirm(cuar.confirmDeleteAttachedFile)){var attachedItem=$(this).closest(base.options.attachmentItem),postId=attachedItem.data("post-id"),filename=attachedItem.data("filename"),nonceValue=base._getAttachmentListRemoveNonce();base._updateAttachmentItemState(attachedItem,"pending");var ajaxParams={action:"cuar_remove_attached_file",post_id:postId,filename:filename,cuar_remove_attachment_nonce:nonceValue};$.post(cuar.ajaxUrl,ajaxParams,function(response){if(0==response.success){var errorMessage="";response.data.length>0&&(errorMessage=response.data[0]),base._showError(attachedItem,filename,errorMessage,!1)}else attachedItem.slideUp(400,function(){1==base._getAttachmentItems().length&&base._getAttachmentListEmptyMessage().show(),attachedItem.remove()})})}},base._onSendFile=function(event,item,method,postId,nonceValue,filename,caption,extra){var tempCaption=caption;(void 0===caption||0==caption.trim().length)&&(tempCaption=filename),base._updateAttachmentItem(item,postId,filename,tempCaption),base._updateAttachmentItemState(item,"pending");var ajaxParams={action:"cuar_attach_file",method:method,post_id:postId,filename:filename,caption:tempCaption,extra:extra},nonceName="cuar_"+method+"_"+postId;ajaxParams[nonceName]=nonceValue,$.post(cuar.ajaxUrl,ajaxParams,function(response){if(0==response.success){var errorMessage="";response.data.length>0&&(errorMessage=response.data[0]),base._showError(item,filename,errorMessage,!0)}else{var newFilename=response.data.file,newCaption=response.data.caption;base._updateAttachmentItem(item,postId,newFilename,newCaption),base._updateAttachmentItemState(item,"success"),$(document).trigger("cuar:attachmentManager:fileAttached",[item,postId,filename,newFilename,newCaption])}})},base._onUpdateFile=function(event,item,postId,nonceValue,filename,caption){var tempCaption=caption;(void 0===caption||0==caption.trim().length)&&(tempCaption=filename),base._updateAttachmentItemState(item,"pending");var ajaxParams={action:"cuar_update_attached_file",post_id:postId,filename:filename,caption:tempCaption,cuar_update_attachment_nonce:nonceValue};$.post(cuar.ajaxUrl,ajaxParams,function(response){if(0==response.success){var errorMessage="";response.data.length>0&&(errorMessage=response.data[0]),base._showError(item,filename,errorMessage,!0)}else{var newFilename=response.data.file,newCaption=response.data.caption;base._updateAttachmentItem(item,postId,newFilename,newCaption),base._updateAttachmentItemState(item,"success")}})},base._onAddAttachmentItem=function(event,postId,filename,caption,extra){if(cuar.maxAttachmentCount>0&&base._getAttachmentItems().length>=cuar.maxAttachmentCount)return base._showError(null,filename,cuar.tooManyAttachmentsAlready,!1),null;var item=base._getAttachmentTemplate().clone();return item.appendTo(base.options.attachmentList),base._updateAttachmentItem(item,postId,filename,caption),base._getAttachmentListEmptyMessage().hide(),item},base._updateAttachmentItem=function(item,postId,filename,caption){(void 0===caption||0==caption.trim().length)&&(caption=filename),item.data("post-id",postId),item.data("filename",filename),item.children(".cuar-caption").html(caption)},base._updateAttachmentItemState=function(item,state){item.removeClass(function(index,css){return(css.match(/(^|\s)cuar-state-\S+/g)||[]).join(" ")}),item.addClass("cuar-state-"+state);var actions=item.children(".cuar-actions"),progress=item.children(".cuar-progress");switch(state){case"pending":actions.hide(),progress.show(),base._updateAttachmentItemProgress(item,0);break;case"error":actions.show(),progress.hide();break;case"success":actions.show(),progress.hide()}},base._updateAttachmentItemProgress=function(item,progress){var progressElt=item.children(".cuar-progress"),indeterminateElt=progressElt.children(".indeterminate"),determinateElt=progressElt.children(".determinate");0>=progress?(indeterminateElt.show(),determinateElt.hide()):(indeterminateElt.hide(),determinateElt.show(),determinateElt.css({width:progress+"%"}))},base._showError=function(item,filename,errorMessage,isRemoveItemRequired){if(null!=item&&(isRemoveItemRequired?item.remove():base._updateAttachmentItemState(item,"error")),null!=errorMessage&&errorMessage.length>0){var html='<p class="cuar-error">';null!=filename&&filename.length>0&&(html+="<strong>"+filename+"</strong> - "),html+=errorMessage,html+='<a href="#" class="cuar-dismiss"><span class="dashicons dashicons-dismiss"></span></a>',html+="</p>",$(html).appendTo(base._getErrorList())}},base._onDismissError=function(event){$(this).closest(".cuar-error").remove(),event.preventDefault()},base._getErrorList=function(){return $(base.options.errorList,base.el)},base._getAttachmentList=function(){return $(base.options.attachmentList)},base._getAttachmentListEmptyMessage=function(){return $(".cuar-empty-message",base._getAttachmentList())},base._getAttachmentItems=function(){return $(base.options.attachmentList+">"+base.options.attachmentItem)},base._getAttachmentItemByFilename=function(filename){return base._getAttachmentItems().filter(function(){return $(this).data("filename")==filename})},base._getAttachmentListRemoveNonce=function(){return $("#cuar_remove_attachment_nonce",base._getAttachmentList()).val()},base._getAttachmentTemplate=function(){return $(base.options.attachmentItemTemplate).children(base.options.attachmentItem).first()},base._getSelectorInput=function(){return $(base.options.selectorInput,base.el)},base._getSelectors=function(){return $(base.options.selectorList+">"+base.options.selectorItem,base.el)},base.init()},$.cuar.fileAttachmentManager.defaultOptions={errorList:".cuar-file-attachment-errors",attachmentList:".cuar-file-attachments",attachmentItem:".cuar-file-attachment",attachmentItemTemplate:".cuar-file-attachment-template",selectorList:".cuar-file-selectors",selectorItem:".cuar-file-selector",selectorInput:".cuar-file-selector-input"},$.fn.fileAttachmentManager=function(options){return this.each(function(){new $.cuar.fileAttachmentManager(this,options)})}}(jQuery),function($){$.cuar||($.cuar={}),$.cuar.ftpUploader=function(el,options){var base=this;base.$el=$(el),base.el=el,base.$el.data("cuar.ftpUploader",base),base.init=function(){base.options=$.extend({},$.cuar.ftpUploader.defaultOptions,options),base._getAddButton().click(base._onAddButtonClicked),$(document).on("cuar:attachmentManager:fileAttached",base._removeFileFromSelect)},base._removeFileFromSelect=function(event,item,postId,oldFilename,newFilename,newCaption){var ftpOperation=base._getFtpOperation();"ftp-move"==ftpOperation&&base._getSelectBox().children().filter(function(){return $(this).val()==oldFilename}).remove()},base._onAddButtonClicked=function(event){event.preventDefault();var selectedFiles=base._getSelectedFiles(),postId=base._getPostId(),ftpOperation=base._getFtpOperation();if(null!=selectedFiles&&0!=selectedFiles.length)for(var i=0,len=selectedFiles.length;len>i;i++){var filename=selectedFiles[i],attachmentItem=$(document).triggerHandler("cuar:attachmentManager:addItem",[postId,filename,filename]);null!=attachmentItem&&$(document).trigger("cuar:attachmentManager:sendFile",[attachmentItem,"ftp-folder",postId,base._getNonce(),filename,"",ftpOperation])}},base._getFtpOperation=function(){return base._getCopyCheckbox().is(":checked")?"ftp-copy":"ftp-move"},base._getNonce=function(){return $("#cuar_ftp-folder_"+base._getPostId(),base.el).val()},base._getPostId=function(){return base.$el.data("post-id")},base._getSelectedFiles=function(){return base._getSelectBox().val()},base._getAddButton=function(){return $(base.options.addButton,base.el)},base._getSelectBox=function(){return $(base.options.selectBox,base.el).first()},base._getCopyCheckbox=function(){return $(base.options.copyCheckbox,base.el).first()},base.init()},$.cuar.ftpUploader.defaultOptions={addButton:".cuar-ftp-add-files",selectBox:".cuar-ftp-file-selection",copyCheckbox:".cuar-copy-file-checkbox"},$.fn.ftpUploader=function(options){return this.each(function(){new $.cuar.ftpUploader(this,options)})}}(jQuery);
//# sourceMappingURL=customer-area.js.map